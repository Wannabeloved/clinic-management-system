/**
 * Форматирует телефонный номер в стандартный формат
 * @param {string} phone - Номер телефона в любом формате
 * @returns {string} - Отформатированный номер в формате +7 (XXX) XXX-XX-XX
 */
export function formatPhoneNumber(phone) {
  if (!phone) {
    throw new Error("Некорректный формат номера телефона");
  }

  // Проверяем, что в номере есть хотя бы одна цифра
  if (!/\d/.test(phone)) {
    throw new Error("Номер телефона должен содержать цифры");
  }

  // Проверяем, что номер содержит только допустимые символы
  if (!/^[\s\(\)\-\+\d\.]+$/.test(phone)) {
    throw new Error("Номер телефона содержит недопустимые символы");
  }

  // Убираем все нецифровые символы (включая пробелы, скобки, дефисы, точки)
  let digits = phone.replace(/[\s\(\)\-\+\.]/g, "");

  // Проверяем, что после удаления символов остались только цифры
  if (!/^\d+$/.test(digits)) {
    throw new Error("Номер телефона должен содержать только цифры");
  }

  // Если номер начинается с 8 и его длина 11 цифр - это российский номер
  if (digits.startsWith("8") && digits.length === 11) {
    digits = "7" + digits.slice(1);
  }
  // Если номер начинается с 8 и его длина 10 цифр - это номер без кода страны
  else if (digits.startsWith("8") && digits.length === 10) {
    digits = "7" + digits.slice(1);
  }
  // Если номер начинается с 9 и его длина 10 цифр - это российский номер без кода страны
  else if (digits.length === 10 && digits.startsWith("9")) {
    digits = "7" + digits;
  }
  // Если длина 10 цифр - возможно это номер без кода страны
  else if (digits.length === 10) {
    digits = "7" + digits;
  }
  // Если номер начинается с 7 - оставляем как есть
  else if (digits.startsWith("7") && digits.length === 11) {
    // ничего не делаем
  }
  // В остальных случаях проверяем длину
  else if (digits.length !== 11) {
    throw new Error("Некорректный формат номера телефона");
  }

  // Если номер не начинается с 7, но длина правильная - заменяем первую цифру на 7
  if (!digits.startsWith("7")) {
    digits = "7" + digits.slice(1);
  }

  // Форматируем номер в нужный формат
  return `+${digits[0]} (${digits.slice(1, 4)}) ${digits.slice(
    4,
    7
  )}-${digits.slice(7, 9)}-${digits.slice(9)}`;
}
